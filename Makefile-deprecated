BUILD_DIR := ./build
SRC_DIRS := ./src
PREFIX ?= $(out)

SRCS := $(shell find $(SRC_DIRS) -name '*.cpp')

TARGETS := $(SRCS:$(SRC_DIRS)/%.cpp=$(BUILD_DIR)/%)

CPPFLAGS := -MMD -MP $(shell pkg-config --cflags opencv4)
LDFLAGS := $(shell pkg-config --libs opencv4)

CXX := g++

.PHONY: all install clean

all: $(TARGETS)

$(BUILD_DIR)/%: $(SRC_DIRS)/%.cpp
	mkdir -p $(BUILD_DIR)
	$(CXX) $(CPPFLAGS) $< -o $@ $(LDFLAGS)

install:
	mkdir -p $(PREFIX)/bin
	$(foreach target, $(TARGETS), cp $(target) $(PREFIX)/bin;)

clean:
	rm -rf $(BUILD_DIR)
